# Enable URL Rewriting
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Security: Block access to sensitive files
    <Files ~ "^\.">
        Order allow,deny
        Deny from all
    </Files>

    # Block access to config files and other sensitive extensions
    <FilesMatch "\.(ini|log|conf|sql|bak|backup|old)$">
        Order allow,deny
        Deny from all
    </FilesMatch>

    # Remove trailing slash from URLs (optional, for consistency)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.+)/$ /$1 [R=301,L]

    # Skip rewrite for existing files or directories
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Handle logout specially (before other rules)
    RewriteRule ^logout/?$ /index.php?logout=1 [L,QSA]

    # Handle root/home page
    RewriteRule ^$ /index.php?page=home [L,QSA]

    ########## ADMIN REWRITES ##########
    
    # Bersihkan URL: /dashboard → admin/mainA.php?section=dashboard (jika masih digunakan)
    # RewriteRule ^dashboard/?$ admin/mainA.php?section=dashboard [L,QSA]
    
    # Bersihkan URL: /admin/users → admin/mainA.php?section=users (jika masih digunakan)
    # RewriteRule ^admin/(dashboard|users|content|services|portfolio|team|messages|analytics|settings)/?$ admin/mainA.php?section=$1 [L,QSA]
    
    # RewriteRule ^admin/anggota/?$ admin/sections/content/anggota.php [L,QSA]
    
    # ADMIN Edit/Delete Anggota (jika masih digunakan)
    # RewriteRule ^admin/edit_anggota/?$ config/admin/edit_anggota.php [L,QSA]
    # RewriteRule ^admin/delete_anggota/?$ config/admin/delete_anggota.php [L,QSA]

    ########## PUBLIC ROUTES ##########
    
    # Semua URL lainnya diarahkan ke index.php?page=...
    RewriteRule ^(.+)$ index.php?page=$1 [L,QSA]

</IfModule>

# Performance: Enable compression (optional)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Performance: Set expire headers (optional)
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/ico "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
</IfModule>

# Optional: Force HTTPS (uncomment if you have SSL)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Optional: Force www (uncomment if needed)
# RewriteCond %{HTTP_HOST} !^www\.
# RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Optional: Remove www (uncomment if you prefer without www)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [L,R=301]